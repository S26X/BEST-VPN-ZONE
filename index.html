<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite VPN | Professional Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@900&display=swap" rel="stylesheet">

    <style>
        :root {
            --p: #4F46E5; --p-glow: rgba(79, 70, 229, 0.2);
            --bg: #F8FAFC; --c: #FFFFFF; --t: #0F172A; --s: #64748B;
            --br: #F1F5F9; --sc: #10B981; --dg: #EF4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; transition: 0.3s; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--t); margin: 0; padding: 0; }

        /* --- BEST LOADING SCREEN --- */
        #loader {
            position: fixed; inset: 0; background: #fff; z-index: 999999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .load-box { position: relative; width: 120px; height: 120px; }
        .ring { position: absolute; inset: 0; border: 4px solid #f0f0f0; border-top-color: var(--p); border-radius: 50%; animation: spin 0.8s linear infinite; }
        .load-img { position: absolute; inset: 20px; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .load-img img { width: 100%; height: 100%; object-fit: cover; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- HEADER & PROFILE --- */
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.8); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 100; }
        .prof { display: flex; align-items: center; gap: 12px; background: #fff; padding: 6px 15px 6px 6px; border-radius: 50px; border: 1.5px solid var(--br); }
        .ava { width: 35px; height: 35px; border-radius: 50%; background: var(--p); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        
        .admin-badge-btn {
            background: var(--t); color: #fff; padding: 10px 18px; border-radius: 15px; font-size: 12px; font-weight: 800;
            display: none; align-items: center; gap: 8px; cursor: pointer; border: none;
        }

        /* --- DASHBOARD STATS --- */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 25px; border: 1.5px solid var(--br); text-align: center; }
        .stat-num { font-size: 28px; font-weight: 900; color: var(--p); display: block; }
        .stat-lbl { font-size: 11px; font-weight: 800; color: var(--s); text-transform: uppercase; }

        /* --- UI ELEMENTS --- */
        .page { padding: 20px; padding-bottom: 120px; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }

        .v-card { background: #fff; padding: 18px; border-radius: 25px; display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border: 1.5px solid var(--br); position: relative; }
        .v-icon { width: 55px; height: 55px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 24px; }

        /* --- FORM STYLES --- */
        .admin-form { background: var(--p-light); padding: 20px; border-radius: 25px; margin-bottom: 25px; border: 1px dashed var(--p); }
        .inp { width: 100%; padding: 14px; border-radius: 15px; border: 1.5px solid #fff; margin-bottom: 10px; font-family: inherit; font-weight: 600; }
        .btn-m { width: 100%; padding: 16px; border-radius: 18px; border: none; background: var(--p); color: #fff; font-weight: 800; cursor: pointer; box-shadow: 0 10px 20px var(--p-glow); }

        /* --- HISTORY CREDENTIALS --- */
        .cred-wrap { display: flex; gap: 10px; margin-top: 15px; }
        .cred-box { flex: 1; background: #f9f9f9; padding: 12px; border-radius: 15px; border: 1.5px solid var(--br); font-size: 13px; font-weight: 700; position: relative; }
        .tag { position: absolute; top: -8px; left: 10px; background: var(--p); color: #fff; font-size: 8px; padding: 2px 7px; border-radius: 5px; }

        /* --- NAVIGATION --- */
        .nav { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 75px; background: #fff; border-radius: 28px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 15px 40px rgba(0,0,0,0.1); z-index: 1000; }
        .n-tab { color: #CBD5E1; text-align: center; font-weight: 800; font-size: 11px; cursor: pointer; }
        .n-tab.active { color: var(--p); }
        .n-tab i { font-size: 24px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="load-box">
            <div class="ring"></div>
            <div class="load-img">
                <img src="https://cdn-icons-png.flaticon.com/512/733/733641.png" alt="Logo">
            </div>
        </div>
        <p style="margin-top:30px; font-weight:900; color:var(--p); letter-spacing:3px;">ELITE SECURE</p>
    </div>

    <div class="header">
        <div class="prof">
            <div class="ava" id="u-ava">?</div>
            <div id="u-name" style="font-weight:800; font-size:13px;">Guest</div>
        </div>
        <button id="admin-top-btn" class="admin-badge-btn" onclick="tab('admin')">
            <i class="fa-solid fa-user-gear"></i> ADMIN
        </button>
    </div>

    <div id="p-home" class="page">
        <div style="background: linear-gradient(135deg, var(--p), #A855F7); border-radius: 30px; padding: 30px; color: #fff; margin-bottom: 25px;">
            <h1 style="margin:0; font-family:'Outfit'; font-size:32px;">VPN Store</h1>
            <p style="margin:5px 0 0 0; opacity:0.8; font-size:14px;">Select a premium service to start.</p>
        </div>
        <div id="catalog-list"></div>
    </div>

    <div id="p-hist" class="page hidden">
        <h2 style="font-weight:900; font-family:'Outfit';">My Orders</h2>
        <div id="user-orders"></div>
    </div>

    <div id="p-help" class="page hidden">
        <div style="text-align:center; padding:50px 20px;">
            <i class="fa-solid fa-headset" style="font-size:60px; color:var(--p);"></i>
            <h2 style="font-weight:900;">24/7 Support</h2>
            <p style="color:var(--s);">Having issues with your account? Contact us now.</p>
            <button class="btn-m" onclick="window.location.href='https://t.me/NibDeveloper'">CHAT WITH ADMIN</button>
        </div>
    </div>

    <div id="p-admin" class="page hidden">
        <div class="stat-grid">
            <div class="stat-card">
                <span class="stat-num" id="stat-pending">0</span>
                <span class="stat-lbl">Pending Orders</span>
            </div>
            <div class="stat-card">
                <span class="stat-num" id="stat-total">0</span>
                <span class="stat-lbl">Total Sales</span>
            </div>
        </div>

        <div class="admin-form">
            <h3 style="margin-top:0;">VPN Management</h3>
            <input id="v-name" class="inp" placeholder="VPN Name (e.g. NordVPN)">
            <div style="display:flex; gap:10px;">
                <input id="v-p1" class="inp" type="number" placeholder="7 Days Price">
                <input id="v-p2" class="inp" type="number" placeholder="30 Days Price">
            </div>
            <button class="btn-m" onclick="addVPN()">ADD/UPDATE VPN</button>
        </div>

        <h3 style="font-weight:900;">Order Management</h3>
        <div id="admin-orders-list"></div>
    </div>

    <div id="sheet" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:10000; display:flex; align-items:flex-end;">
        <div style="background:#fff; width:100%; padding:30px; border-radius:40px 40px 0 0;">
            <h2 id="sh-name" style="margin:0; font-weight:900;">VPN</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin:25px 0;">
                <div class="v-card" id="plan1-btn" style="flex-direction:column; text-align:center;" onclick="selPlan(1)">
                    <b>7 Days</b><span id="sh-p1">৳ 0</span>
                </div>
                <div class="v-card" id="plan2-btn" style="flex-direction:column; text-align:center;" onclick="selPlan(2)">
                    <b>30 Days</b><span id="sh-p2">৳ 0</span>
                </div>
            </div>
            <p style="font-size:12px; font-weight:800; color:var(--s);">PAYMENT METHOD</p>
            <div style="display:flex; gap:10px;">
                <button class="btn-m" style="background:#E2136E;" onclick="pay('Bkash')">Bkash</button>
                <button class="btn-m" style="background:#F7941E;" onclick="pay('Nagad')">Nagad</button>
            </div>
            <button class="btn-m" style="margin-top:20px; background:var(--t);" onclick="closeSheet()">CANCEL</button>
        </div>
    </div>

    <nav class="nav">
        <div class="n-tab active" onclick="tab('home')"><i class="fa-solid fa-house"></i>Home</div>
        <div class="n-tab" onclick="tab('hist')"><i class="fa-solid fa-receipt"></i>Orders</div>
        <div class="n-tab" onclick="tab('help')"><i class="fa-solid fa-circle-info"></i>Help</div>
    </nav>

    <script>
        // 1. FIREBASE & TG INIT
        const firebaseConfig = {
            apiKey: "AIzaSyDZQHw4-DdUdDmJXcuK_88JrJxv35FfYeY",
            authDomain: "vpn-store-s26x.firebaseapp.com",
            databaseURL: "https://vpn-store-s26x-default-rtdb.firebaseio.com",
            projectId: "vpn-store-s26x",
            storageBucket: "vpn-store-s26x.firebasestorage.app",
            messagingSenderId: "373050662329",
            appId: "1:373050662329:web:b3d02424ef0986d6abea68"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        
        // ADMIN ID (APNAR ID DIYE CHANGE KOREN)
        const adminID = 8505710811; 
        const user = tg.initDataUnsafe.user || { id: 8505710811, first_name: "Admin" };

        let currentOrder = { vpn: '', p1: 0, p2: 0, selP: '', selRate: 0 };

        window.onload = () => {
            document.getElementById('u-name').innerText = user.first_name;
            document.getElementById('u-ava').innerText = user.first_name.charAt(0);
            
            // SHOW ADMIN BUTTON ONLY FOR ADMIN
            if(user.id === adminID) document.getElementById('admin-top-btn').style.display = 'flex';

            loadProducts();
            setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 3000);
            tg.expand();
        };

        function getBranding(n) {
            const name = n.toLowerCase();
            if(name.includes('express')) return { i: 'fa-bolt', c: '#FF4757', b: '#FFF0F1' };
            if(name.includes('nord')) return { i: 'fa-shield-halved', c: '#3867D6', b: '#EFF3FF' };
            return { i: 'fa-globe', c: '#20BF6B', b: '#EBFAF2' };
        }

        // 2. USER FUNCTIONS
        function loadProducts() {
            db.ref('products').on('value', snap => {
                const list = document.getElementById('catalog-list'); list.innerHTML = '';
                snap.forEach(c => {
                    const p = c.val(); const b = getBranding(p.name);
                    list.innerHTML += `
                        <div class="v-card" onclick="openSheet('${p.name}', ${p.p1}, ${p.p2})">
                            <div class="v-icon" style="background:${b.b}; color:${b.c}"><i class="fa-solid ${b.i}"></i></div>
                            <div style="flex:1;"><b>${p.name}</b><br><small>Ultra Speed Premium</small></div>
                            <i class="fa-solid fa-chevron-right" style="color:#ddd"></i>
                        </div>`;
                });
            });
        }

        function openSheet(n, p1, p2) {
            currentOrder = { vpn: n, p1, p2 };
            document.getElementById('sh-name').innerText = n;
            document.getElementById('sh-p1').innerText = "৳ " + p1;
            document.getElementById('sh-p2').innerText = "৳ " + p2;
            document.getElementById('sheet').classList.remove('hidden');
        }

        function closeSheet() { document.getElementById('sheet').classList.add('hidden'); }

        function selPlan(p) {
            currentOrder.selP = p === 1 ? '7 Days' : '30 Days';
            currentOrder.selRate = p === 1 ? currentOrder.p1 : currentOrder.p2;
            alert("Plan Selected: " + currentOrder.selP);
        }

        function pay(method) {
            if(!currentOrder.selP) return alert("Select Plan First!");
            const trx = prompt(`Send ৳${currentOrder.selRate} to our ${method} number and enter TrxID:`);
            if(trx) {
                db.ref('orders').push({
                    uid: user.id, uName: user.first_name, vpn: currentOrder.vpn,
                    plan: currentOrder.selP, rate: currentOrder.selRate, method, trx, status: 'Pending', time: new Date().toLocaleString()
                });
                alert("Order Placed Successfully!"); closeSheet();
            }
        }

        function tab(t) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById('p-'+t).classList.remove('hidden');
            document.querySelectorAll('.n-tab').forEach(b => b.classList.remove('active'));
            if(t === 'hist') loadHistory();
            if(t === 'admin') loadAdminData();
        }

        function loadHistory() {
            db.ref('orders').orderByChild('uid').equalTo(user.id).on('value', snap => {
                const list = document.getElementById('user-orders'); list.innerHTML = '';
                snap.forEach(c => {
                    const o = c.val();
                    const mail = o.creds ? o.creds.split(':')[0] : 'Wait...';
                    const pass = o.creds ? o.creds.split(':')[1] : 'Wait...';
                    list.innerHTML += `
                        <div class="v-card" style="flex-direction:column; align-items:flex-start;">
                            <div style="display:flex; justify-content:space-between; width:100%;">
                                <b>${o.vpn} (${o.plan})</b>
                                <span style="color:var(--p); font-weight:800; font-size:12px;">${o.status}</span>
                            </div>
                            <div class="cred-wrap" style="width:100%;">
                                <div class="cred-box" onclick="copy('${mail}')"><span class="tag">MAIL</span>${mail}</div>
                                <div class="cred-box" onclick="copy('${pass}')"><span class="tag">PASS</span>${pass}</div>
                            </div>
                        </div>`;
                });
            });
        }

        // 3. ADMIN FUNCTIONS
        function addVPN() {
            const name = document.getElementById('v-name').value;
            const p1 = document.getElementById('v-p1').value;
            const p2 = document.getElementById('v-p2').value;
            if(name && p1 && p2) {
                db.ref('products').push({ name, p1, p2 });
                alert("VPN Added to Management!");
            }
        }

        function loadAdminData() {
            db.ref('orders').on('value', snap => {
                const list = document.getElementById('admin-orders-list'); list.innerHTML = '';
                let pendingCount = 0; let totalSales = 0;
                snap.forEach(c => {
                    const o = c.val();
                    if(o.status === 'Pending') {
                        pendingCount++;
                        list.innerHTML += `
                            <div class="v-card" style="flex-direction:column; align-items:flex-start; border-left:5px solid orange;">
                                <b>${o.uName} (ID: ${o.uid})</b>
                                <small>${o.vpn} | ${o.plan} | ${o.method} | Trx: ${o.trx}</small>
                                <input id="inp-${c.key}" class="inp" placeholder="email:pass" style="margin-top:10px;">
                                <button class="btn-m" style="background:var(--sc);" onclick="deliver('${c.key}')">DELIVER</button>
                            </div>`;
                    }
                    if(o.status === 'Delivered') totalSales += parseInt(o.rate || 0);
                });
                document.getElementById('stat-pending').innerText = pendingCount;
                document.getElementById('stat-total').innerText = "৳ " + totalSales;
            });
        }

        function deliver(key) {
            const val = document.getElementById('inp-'+key).value;
            if(val) db.ref('orders/'+key).update({ status: 'Delivered', creds: val });
        }

        function copy(t) { navigator.clipboard.writeText(t); alert("Copied!"); }
    </script>
</body>
</html>
